# RemoteHive Security Configuration
# This file contains security settings and configurations for the RemoteHive application

# =============================================================================
# FIREWALL RULES (UFW Configuration)
# =============================================================================

# Default policies
# ufw --force reset
# ufw default deny incoming
# ufw default allow outgoing

# SSH access (restrict to specific IPs if possible)
# ufw allow from YOUR_IP_ADDRESS to any port 22
# ufw allow 22/tcp

# HTTP and HTTPS
# ufw allow 80/tcp
# ufw allow 443/tcp

# Application ports
# ufw allow 8000/tcp  # Backend API
# ufw allow 8001/tcp  # Autoscraper Service
# ufw allow 3000/tcp  # Admin Panel
# ufw allow 5173/tcp  # Public Website

# Database (restrict to localhost only)
# ufw deny 5432/tcp

# Monitoring
# ufw allow 9090/tcp  # Prometheus metrics

# Enable firewall
# ufw --force enable

# =============================================================================
# FAIL2BAN CONFIGURATION
# =============================================================================

# SSH Protection
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 3600
findtime = 600

# Nginx Protection
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
logpath = /var/log/nginx/error.log
maxretry = 5
bantime = 3600

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
logpath = /var/log/nginx/error.log
maxretry = 10
bantime = 3600

[nginx-botsearch]
enabled = true
filter = nginx-botsearch
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

# Application-specific protection
[remotehive-api]
enabled = true
filter = remotehive-api
logpath = /opt/remotehive/logs/app.log
maxretry = 10
bantime = 1800
findtime = 300

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================

# SSL Protocols (for Nginx)
ssl_protocols = TLSv1.2 TLSv1.3

# SSL Ciphers
ssl_ciphers = ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384

# SSL Session Settings
ssl_session_cache = shared:SSL:10m
ssl_session_timeout = 10m

# OCSP Stapling
ssl_stapling = on
ssl_stapling_verify = on

# HSTS Settings
hsts_max_age = 31536000
hsts_include_subdomains = true
hsts_preload = true

# =============================================================================
# SECURITY HEADERS
# =============================================================================

# Content Security Policy
csp_default_src = 'self'
csp_script_src = 'self' 'unsafe-inline' 'unsafe-eval'
csp_style_src = 'self' 'unsafe-inline'
csp_img_src = 'self' data: https:
csp_font_src = 'self' data:
csp_connect_src = 'self' https:
csp_frame_ancestors = 'self'

# Other Security Headers
x_frame_options = SAMEORIGIN
x_content_type_options = nosniff
x_xss_protection = 1; mode=block
referrer_policy = strict-origin-when-cross-origin

# =============================================================================
# RATE LIMITING CONFIGURATION
# =============================================================================

# API Rate Limits
api_rate_limit = 100/minute
api_burst_limit = 20

# Web Rate Limits
web_rate_limit = 300/minute
web_burst_limit = 50

# Admin Rate Limits
admin_rate_limit = 50/minute
admin_burst_limit = 10

# Scraper Rate Limits
scraper_rate_limit = 10/minute
scraper_burst_limit = 5

# =============================================================================
# AUTHENTICATION SECURITY
# =============================================================================

# Password Policy
min_password_length = 12
require_uppercase = true
require_lowercase = true
require_numbers = true
require_special_chars = true
password_history = 5
password_expiry_days = 90

# Account Lockout Policy
max_login_attempts = 5
lockout_duration = 1800  # 30 minutes
lockout_threshold_time = 900  # 15 minutes

# Session Security
session_timeout = 1800  # 30 minutes
session_cookie_secure = true
session_cookie_httponly = true
session_cookie_samesite = strict

# JWT Security
jwt_expiry = 1800  # 30 minutes
jwt_refresh_expiry = 604800  # 7 days
jwt_algorithm = HS256

# =============================================================================
# FILE UPLOAD SECURITY
# =============================================================================

# File Upload Restrictions
max_file_size = 10MB
allowed_file_types = jpg,jpeg,png,gif,pdf,doc,docx,txt,csv,xlsx
forbidden_file_types = exe,bat,sh,php,asp,jsp,js,html,htm

# Upload Directory Security
upload_directory = /opt/remotehive/uploads
upload_permissions = 644
upload_directory_permissions = 755

# Virus Scanning (if ClamAV is installed)
virus_scan_enabled = true
virus_scan_timeout = 30

# =============================================================================
# DATABASE SECURITY
# =============================================================================

# Connection Security
db_ssl_mode = require
db_ssl_cert = /opt/remotehive/ssl/client-cert.pem
db_ssl_key = /opt/remotehive/ssl/client-key.pem
db_ssl_ca = /opt/remotehive/ssl/ca-cert.pem

# Connection Pool Security
db_pool_size = 20
db_max_overflow = 30
db_pool_timeout = 30
db_pool_recycle = 3600

# Query Security
db_query_timeout = 30
db_statement_timeout = 60

# =============================================================================
# API SECURITY
# =============================================================================

# CORS Configuration
cors_allowed_origins = https://remotehive.com,https://admin.remotehive.com
cors_allowed_methods = GET,POST,PUT,DELETE,OPTIONS
cors_allowed_headers = Content-Type,Authorization,X-Requested-With
cors_allow_credentials = true
cors_max_age = 86400

# API Key Security
api_key_length = 32
api_key_expiry = 365  # days
api_key_rate_limit = 1000/hour

# Request Validation
max_request_size = 10MB
max_json_payload = 1MB
max_form_fields = 100

# =============================================================================
# LOGGING AND MONITORING SECURITY
# =============================================================================

# Security Event Logging
security_log_file = /var/log/remotehive-security.log
security_log_level = INFO
security_log_rotation = daily
security_log_retention = 90  # days

# Audit Logging
audit_log_enabled = true
audit_log_file = /var/log/remotehive-audit.log
audit_events = login,logout,password_change,admin_action,data_access

# Failed Login Monitoring
failed_login_threshold = 10
failed_login_window = 300  # 5 minutes
failed_login_action = alert

# =============================================================================
# BACKUP SECURITY
# =============================================================================

# Backup Encryption
backup_encryption_enabled = true
backup_encryption_algorithm = AES-256-CBC
backup_encryption_key_file = /opt/remotehive/keys/backup.key

# Backup Access Control
backup_directory = /opt/remotehive/backups
backup_permissions = 600
backup_owner = remotehive
backup_group = remotehive

# =============================================================================
# INTRUSION DETECTION
# =============================================================================

# File Integrity Monitoring
fim_enabled = true
fim_directories = /opt/remotehive,/etc/nginx,/etc/systemd/system
fim_check_interval = 3600  # 1 hour

# Log Analysis
log_analysis_enabled = true
log_analysis_patterns = /opt/remotehive/config/security/threat-patterns.txt
log_analysis_interval = 300  # 5 minutes

# Network Monitoring
network_monitoring_enabled = true
network_monitoring_interface = eth0
network_monitoring_suspicious_ports = 1433,3389,5432,6379

# =============================================================================
# INCIDENT RESPONSE
# =============================================================================

# Alert Configuration
alert_email = security@remotehive.com
alert_slack_webhook = https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
alert_severity_threshold = HIGH

# Automatic Response
auto_block_enabled = true
auto_block_threshold = 50  # failed attempts
auto_block_duration = 3600  # 1 hour

# Incident Logging
incident_log_file = /var/log/remotehive-incidents.log
incident_retention = 365  # days

# =============================================================================
# COMPLIANCE SETTINGS
# =============================================================================

# Data Retention
data_retention_period = 2555  # 7 years in days
log_retention_period = 2555  # 7 years in days
backup_retention_period = 2555  # 7 years in days

# Privacy Settings
data_anonymization_enabled = true
pii_encryption_enabled = true
right_to_be_forgotten_enabled = true

# Audit Requirements
audit_trail_enabled = true
audit_trail_immutable = true
audit_trail_retention = 2555  # 7 years in days

# =============================================================================
# SECURITY SCANNING
# =============================================================================

# Vulnerability Scanning
vuln_scan_enabled = true
vuln_scan_schedule = 0 2 * * 0  # Weekly on Sunday at 2 AM
vuln_scan_tools = nmap,nikto,sqlmap

# Dependency Scanning
dep_scan_enabled = true
dep_scan_schedule = 0 3 * * *  # Daily at 3 AM
dep_scan_tools = safety,bandit,npm-audit

# Code Security Scanning
code_scan_enabled = true
code_scan_tools = semgrep,bandit,eslint-security
code_scan_on_commit = true

# =============================================================================
# EMERGENCY PROCEDURES
# =============================================================================

# Emergency Contacts
emergency_contact_1 = +1-555-0123
emergency_contact_2 = +1-555-0124
emergency_email = emergency@remotehive.com

# Emergency Shutdown
emergency_shutdown_enabled = true
emergency_shutdown_command = /opt/remotehive/scripts/emergency-shutdown.sh

# Disaster Recovery
dr_plan_location = /opt/remotehive/docs/disaster-recovery-plan.pdf
dr_backup_location = s3://remotehive-dr-backups/
dr_rto = 4  # hours
dr_rpo = 1  # hour

# =============================================================================
# SECURITY MAINTENANCE
# =============================================================================

# Security Updates
security_update_schedule = 0 4 * * 1  # Weekly on Monday at 4 AM
security_update_auto_install = true
security_update_reboot_required = true

# Security Review Schedule
security_review_frequency = quarterly
security_review_checklist = /opt/remotehive/docs/security-checklist.pdf

# Penetration Testing
pentest_frequency = annually
pentest_scope = full
pentest_report_location = /opt/remotehive/docs/pentest-reports/